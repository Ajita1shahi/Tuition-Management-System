{% load static %}  
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0">
  <title>SBL Learning Institute - Dashboard</title>
  <link rel="shortcut icon" href="{% static 'assets/img/favicon.png' %}">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap">
  <link rel="stylesheet" href="{% static 'assets/plugins/bootstrap/css/bootstrap.min.css' %}">
  <link rel="stylesheet" href="{% static 'assets/plugins/fontawesome/css/all.min.css' %}">
  <link rel="stylesheet" href="{% static 'assets/css/style.css' %}">
</head>

<body>
  <div class="main-wrapper">

    <!-- HEADER -->
    <div class="header">
      <div class="header-left d-flex align-items-center ps-3">
        <a href="{% url 'dashboard' %}" class="logo d-flex align-items-center text-decoration-none">
          <div style="width:60px;height:60px;">
            <img src="{% static 'assets/img/sbl1-logo.png' %}" alt="SBL Logo" style="width:70%;height:auto;">
          </div>
          <span class="ms-2 fw-semibold" style="font-size:18px;font-family:'Poppins',sans-serif;color:#2E3A59;">
            <span style="background:linear-gradient(90deg,#1E4DB7,#2E86DE);
                         background-clip:text;
                         -webkit-background-clip:text;
                         -webkit-text-fill-color:transparent;">
              SBL Learning Institute
            </span>
          </span>
        </a>
      </div>

      <a href="javascript:void(0);" id="toggle_btn" class="ms-3"><i class="fas fa-align-left"></i></a>

      <!-- SEARCH -->
      <div class="top-nav-search">
        <form>
          <input type="text" class="form-control" placeholder="Search here">
          <button class="btn" type="submit"><i class="fas fa-search"></i></button>
        </form>
      </div>

      <a class="mobile_btn" id="mobile_btn"><i class="fas fa-bars"></i></a>

      <ul class="nav user-menu">

        <!-- NOTIFICATIONS -->
        <li class="nav-item dropdown noti-dropdown">
          <a href="#" class="dropdown-toggle nav-link" data-bs-toggle="dropdown">
            <i class="far fa-bell"></i>
            {% if unread_notification_count > 0 %}
              <span class="badge bg-danger rounded-pill">{{ unread_notification_count }}</span>
            {% endif %}
          </a>
          <div class="dropdown-menu dropdown-menu-end notifications shadow">
            <div class="topnav-dropdown-header d-flex justify-content-between align-items-center px-3 py-2 border-bottom">
              <span class="fw-bold">Notifications</span>
              <a href="#" class="text-danger clear-noti small">Clear All</a>
            </div>
            <div class="noti-content p-2">
              <ul class="list-unstyled mb-0 notification-list">
                {% if unread_notification %}
                  {% for notification in unread_notification %}
                  <li class="py-2 border-bottom">
                    <div class="d-flex align-items-start">
                      <span class="avatar avatar-sm me-2">
                        <img class="avatar-img rounded-circle" src="{% static 'assets/img/profiles/avatar-02.jpg' %}">
                      </span>
                      <div class="flex-fill">
                        <p class="mb-0"><strong>{{ notification.user.username }}</strong> {{ notification.message }}</p>
                        <small class="text-muted">{{ notification.created_at|timesince }} ago</small>
                      </div>
                    </div>
                  </li>
                  {% endfor %}
                {% else %}
                  <li class="text-center text-muted py-3">No new notifications</li>
                {% endif %}
              </ul>
            </div>
            <div class="topnav-dropdown-footer text-center border-top py-2">
              <a href="#" class="small text-primary">View all Notifications</a>
            </div>
          </div>
        </li>

        <!-- USER MENU -->
        <li class="nav-item dropdown has-arrow">
          <a href="#" class="dropdown-toggle nav-link" data-bs-toggle="dropdown">
            <span class="user-img">
              <img class="rounded-circle" src="{% static 'assets/img/profiles/avatar-01.jpg' %}" width="31">
            </span>
          </a>
          <div class="dropdown-menu dropdown-menu-end">
            <div class="user-header text-center p-3 border-bottom">
              <div class="avatar avatar-sm mb-2">
                <img src="{% static 'assets/img/profiles/avatar-01.jpg' %}" class="avatar-img rounded-circle">
              </div>
              <div class="user-text">
                <h6 class="mb-0">{{ request.user.username }}</h6>
                <p class="text-muted small mb-0">{{ request.user.user_type|title }}</p>
              </div>
            </div>
            <a class="dropdown-item" href="#">My Profile</a>
            <a class="dropdown-item" href="{% url 'logout' %}">Logout</a>
          </div>
        </li>

      </ul>
    </div>

    <!-- SIDEBAR -->
    <div class="sidebar" id="sidebar">
      <div class="sidebar-inner slimscroll">
        <div id="sidebar-menu" class="sidebar-menu">
          <ul>

            <li class="menu-title"><span>Main Menu</span></li>

            <!-- ADMIN -->
            {% if user.user_type == "admin" %}
              <li><a href="{% url 'admin_dashboard' %}"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>
              <li><a href="{% url 'teacher_list' %}"><i class="fas fa-chalkboard-teacher"></i> Teachers</a></li>
              <li style="margin-left:25px;"><a href="{% url 'add_teacher' %}"><i class="fas fa-plus-circle"></i> Add Teacher</a></li>
              <li><a href="{% url 'student_list' %}"><i class="fas fa-user-graduate"></i> Students</a></li>
              <li style="margin-left:25px;"><a href="{% url 'add_student' %}"><i class="fas fa-plus-circle"></i> Add Student</a></li>
              <li><a href="{% url 'receptionist_list' %}"><i class="fas fa-concierge-bell"></i> Receptionists</a></li>
              <li style="margin-left:25px;"><a href="{% url 'add_receptionist' %}"><i class="fas fa-user-plus"></i> Add Receptionist</a></li>

              <li class="menu-title"><span>Accounts</span></li>
              <li><a href="{% url 'fee_list' %}"><i class="fas fa-file-invoice-dollar"></i> Fees</a></li>
              <li><a href="{% url 'expense_list' %}"><i class="fas fa-wallet"></i> Expenses</a></li>
              <li><a href="{% url 'salary_list' %}"><i class="fas fa-hand-holding-usd"></i> Salaries</a></li>

            <!-- TEACHER -->
            {% elif user.user_type == "teacher" %}
              <li><a href="{% url 'teacher_dashboard' %}"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>
              <li><a href="{% url 'teacher_subjects' %}"><i class="fas fa-book"></i> My Subjects</a></li>
              <li><a href="{% url 'teacher_students' %}"><i class="fas fa-user-graduate"></i> Students</a></li>
              <li><a href="{% url 'add_marks' %}"><i class="fas fa-chart-line"></i> Add Marks</a></li>

            <!-- STUDENT -->
            {% elif user.user_type == "student" %}
              <li><a href="{% url 'student_dashboard' %}"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>
              <li><a href="{% url 'student_my_fees' %}"><i class="fas fa-comment-dollar"></i> My Fees</a></li>
              <li><a href="{% url 'student_learning_activities' %}"><i class="fas fa-graduation-cap"></i> Learning Activities</a></li>
              <li><a href="{% url 'student_performance' %}"><i class="fas fa-chart-line"></i> Performance</a></li>

            <!-- RECEPTIONIST -->
            {% elif user.user_type == "receptionist" %}
              <li><a href="{% url 'receptionist_dashboard' %}"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>

              <!-- NEW: Receptionist can also view TEACHERS -->
              <li><a href="{% url 'teacher_list' %}"><i class="fas fa-chalkboard-teacher"></i> Teachers</a></li>

              <li><a href="{% url 'receptionist_students' %}"><i class="fas fa-user-graduate"></i> Students</a></li>

              <li class="menu-title"><span>Accounts</span></li>
              <li><a href="{% url 'accounts_dashboard' %}"><i class="fas fa-chart-pie"></i> Accounts</a></li>
              <li><a href="{% url 'fee_list' %}"><i class="fas fa-file-invoice-dollar"></i> Fees</a></li>
              <li><a href="{% url 'expense_list' %}"><i class="fas fa-wallet"></i> Expenses</a></li>
              <li><a href="{% url 'salary_list' %}"><i class="fas fa-hand-holding-usd"></i> Salaries</a></li>
            {% endif %}

            <li class="menu-title"><span>Account</span></li>
            <li><a href="{% url 'logout' %}"><i class="fas fa-sign-out-alt"></i> Logout</a></li>

          </ul>
        </div>
      </div>
    </div>

    <!-- FLASH MESSAGES (toast-style, top-right) -->
    {% if messages %}
      <div aria-live="polite" aria-atomic="true"
           class="position-fixed"
           style="top:90px; right:20px; z-index:9999;">
        {% for message in messages %}
          <div class="alert alert-{{ message.tags }} shadow-sm mb-2 py-2 px-3 app-flash-message"
               role="alert"
               style="border-radius:999px; min-width:260px; max-width:360px;">
            {{ message }}
          </div>
        {% endfor %}
      </div>
    {% endif %}

    <!-- MAIN CONTENT BLOCK -->
    {% block content %}{% endblock %}

  </div>

  <!-- SCRIPTS -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="{% static 'assets/js/jquery-3.6.0.min.js' %}"></script>
  <script src="{% static 'assets/js/popper.min.js' %}"></script>
  <script src="{% static 'assets/plugins/bootstrap/js/bootstrap.min.js' %}"></script>
  <script src="{% static 'assets/plugins/slimscroll/jquery.slimscroll.min.js' %}"></script>
  <script src="{% static 'assets/js/script.js' %}"></script>

  <script>
    $(document).ready(function () {
      // Clear notifications
      $('.clear-noti').click(function (e) {
        e.preventDefault();
        fetch("{% url 'clear_all_notifications' %}", {
          method: 'POST',
          headers: { 'X-CSRFToken': '{{ csrf_token }}' }
        }).then(res => res.json()).then(data => {
          if (data.status === 'success') {
            $('.notification-list').html('<li class="text-center text-muted py-3">No new notifications</li>');
          }
        });
      });

      // Sidebar toggle
      $('#toggle_btn').on('click', function () {
        $('body').toggleClass('mini-sidebar');
      });

      // Auto hide flash messages after 4 seconds
      setTimeout(function () {
        $('.app-flash-message').fadeOut(500, function () {
          $(this).remove();
        });
      }, 4000);
    });
  </script>

</body>
</html>
